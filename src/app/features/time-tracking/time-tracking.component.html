<div class="container grid">
  <div class="col-12">
    <div [formGroup]="selectFormGroup" class="card flex justify-content-between">
      <p-select
        [formControlName]="SELECT_FORM_GROUP_KEY.pic"
        [options]="userListOptions()"
        placeholder="Chọn tên nhân viên" />

      <p-select
        [formControlName]="SELECT_FORM_GROUP_KEY.project"
        [options]="userListOptions()"
        placeholder="Chọn dự án" />


      <span>Thống kê theo : </span>
      <p-togglebutton [(ngModel)]="checked" offLabel="Hôm nay" onLabel="Hôm nay" styleClass="w-24"></p-togglebutton>
      <p-togglebutton [(ngModel)]="checked" offLabel="Tuần này" onLabel="Tuần này" styleClass="w-24"></p-togglebutton>
      <p-togglebutton [(ngModel)]="checked" offLabel="Tháng này" onLabel="Tháng này" styleClass="w-24"></p-togglebutton>
      <p-datepicker
        [formControlName]="SELECT_FORM_GROUP_KEY.dateRange"
        selectionMode="range"></p-datepicker>
    </div>
  </div>

  <div class="col-12">
    <p-tabs (valueChange)="onTabChange($event)" [value]="activeTabIndex()">
      <p-tablist>
        <p-tab [value]="0">Dự toán</p-tab>
        <p-tab [value]="1">Log work</p-tab>
        <p-tab [value]="2">Vấn đề</p-tab>
        <p-tab [value]="3">Bug & Improvement</p-tab>
      </p-tablist>
      <p-tabpanels>
        <p-tabpanel [value]="activeTabIndex()">
          <div class="flex justify-content-end">
            <p-splitbutton
              (onClick)="onAddNewRow()"
              [model]="createButtonMenu"
              icon="pi pi-plus"
              label="Thêm mới" />
          </div>
          <ng-container *ngTemplateOutlet="tableDataTemplate"></ng-container>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </div>
</div>

<ng-template #tableDataTemplate>
  <p-table
    [value]="tableData"
    responsiveLayout="scroll"
  >
    <ng-template pTemplate="header">
      <tr>
        @for (col of headerColumns(); track col.value) {
          <th>{{ col.label }}</th>
        }
      </tr>
    </ng-template>

    <ng-template pTemplate="frozenbody">
      @if (mode() === EMode.CREATE) {
        <tr>
          <td>11111</td>
          <td>11111</td>
          <td>11111</td>
          <td>11111</td>
          <td>11111</td>
          <td>11111</td>
          <td>11111</td>
          <td>11111</td>
          <td>11111</td>
          <td>11111</td>
          <td>11111</td>
          <td>11111</td>
          <td>
            <div class="flex align-items-center justify-content-between gap-1">
              <p-button
                variant="outlined" severity="secondary" size="small" icon="pi pi-save"
                aria-label="Lưu" pTooltip="Lưu" tooltipPosition="bottom" />
              <p-button
                variant="outlined" severity="secondary" size="small" icon="pi pi-times" aria-label="Hủy"
                pTooltip="Hủy" tooltipPosition="bottom" />
            </div>
          </td>
        </tr>
      }
    </ng-template>

    <ng-template let-l let-rowData pTemplate="body">
      <tr>
        @for (col of headerColumns(); track col.value) {
          @if (col.value === EColumnField.START_TIME || col.value === EColumnField.END_TIME) {
            <td>{{ rowData[col.value] | formatDate }}</td>
          } @else if (col.value === EColumnField.ACTIONS) {
            <td>
              <div class="flex align-items-center justify-content-between gap-1">
                <p-button
                  variant="outlined" severity="secondary" size="small" icon="pi pi-file-edit"
                  aria-label="Chỉnh sửa" pTooltip="Chỉnh sửa" tooltipPosition="bottom" />
                <p-button
                  variant="outlined" severity="secondary" size="small" icon="pi pi-trash" aria-label="Xóa"
                  pTooltip="Xóa" tooltipPosition="bottom" />
              </div>
            </td>
          } @else {
            <td>{{ rowData[col.value] }}</td>
          }
        }
      </tr>
    </ng-template>
  </p-table>
  <div class="card flex justify-center">
    <p-paginator
      (onPageChange)="onPageChange($event)"
      [first]="pagination().page"
      [rowsPerPageOptions]="[10, 20, 30, 40, 50]"
      [rows]="pagination().size"
      [showCurrentPageReport]="true"
      [totalRecords]="pagination().totalElements"
      currentPageReportTemplate="Đang xem {first} - {last} / {totalRecords}" />
  </div>
</ng-template>
